<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>jPlusUI 类图</title>
    <script src="../../../assets/demo/demo.js" type="text/javascript"></script>

    <style>
        body {
            font-family: 'Segoe UI',Verdana,Arial;
        }

        .object {
            border: 1px solid #716F64;
            border-radius: 10px;
            box-shadow: #D8D8D8 4px 4px;
            font-size: 14px;
            line-height: 20px;
            width: 150px;
        }

            .object header {
                background-image: linear-gradient(to right, #D3DCEF, #FEFFFF);
                font-weight: bold;
                border-radius: 10px 10px 0 0;
                font-size: 12px;
                padding: 6px 10px 10px;
                border-bottom: 1px solid #DFE1E3;
            }

                .object header a {
                    text-decoration: none;
                    color: #000;
                }

                    .object header a:hover {
                        text-decoration: underline;
                    }

        .interface header {
            background-image: linear-gradient(to right, #E6F0DB, #FEFFFF);
        }

        .object .collapse {
            float: right;
            width: 25px;
            height: 20px;
            background: url(assets/arrow.png) no-repeat right top;
            cursor: pointer;
        }

        .object header h4 {
            float: left;
            margin: 0;
            font-size: 16px;
            line-height: 20px;
        }

        .object dl {
            margin: 0 0 10px;
        }

        .object dt {
            background: #F0F2F9;
            font-size: 12px;
            padding: 0 5px;
            font-weight: 300;
        }

        .interface .object dt {
            background: #F3F7F0;
        }

        .object dd {
            margin-left: 0;
            line-height: 24px;
        }

            .object dd a {
                color: #000000;
                text-decoration: none;
                display: block;
            }

                .object dd a:hover {
                    background: #ebebeb;
                }

        .rightarrow {
            float: left;
            width: 18px;
            height: 20px;
            background: url(assets/arrow.png) no-repeat left bottom;
        }

        .collapsed header {
            border-radius: 10px;
        }

        .collapsed .collapse {
            background-position: 100% -20px;
        }

        .collapsed dl {
            display: none;
        }

        .icon-member {
            background: url(assets/icons.gif) no-repeat left center;
            width: 24px;
            height: 20px;
            margin-top: 4px;
            float: left;
        }

        .icon-none {
            width: 20px;
            background: none;
        }


        .icon-static {
            width: 20px;
            background-position: 100% 4px;
            background-image: url(assets/static.gif);
        }

        .icon-namespace {
            background-position: 0 0;
        }

        .icon-class {
            background-position: 0 -40px;
        }

        .icon-interface {
            background-position: 0 -80px;
        }

        .icon-method, .icon-function {
            background-position: 0 -160px;
        }

        .icon-property {
            background-position: 0 -200px;
        }

        .icon-field {
            background-position: 0 -240px;
        }

        .icon-event {
            background-position: 0 -280px;
        }

        .source {
            position: absolute;
            z-index: 1010;
            -webkit-background-clip: padding-box;
            -moz-background-clip: padding;
            background-clip: padding-box;
            border: 3px solid #333;
            -webkit-border-radius: 6px;
            -moz-border-radius: 6px;
            border-radius: 6px;
            -webkit-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
            -moz-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
            min-width: 200px;
        }

            .source .arrow {
                font-family: "SimSun";
                overflow: hidden;
                display: block;
                font-size: 21px;
                line-height: 20px;
                position: absolute;
                content: "\25c6";
                color: #000000;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                -o-user-select: none;
                user-select: none;
                height: 20px;
                width: 10px;
                left: -10px;
                top: 15px;
                color: #333;
                margin-top: -10px;
            }

            .source .arrow-back {
                position: absolute;
                top: 0;
                left: 1px;
            }

            .source pre {
                margin: 0;
            }

        .arrow-top, .arrow-circle {
            font-family: Arial, sans-serif;
            font-size: 12px;
        }

        .arrow-circle {
            font-size: 35px;
        }

        .line-horizonal {
            height: 0;
            border-top: 1px solid #716F64;
        }

        .line-vertical {
            width: 0;
            border-left: 1px solid #716F64;
        }

        #body {
            width: 980px;
            overflow: auto;
            height: 600px;
            position: relative;
        }

        #body > * {
            position: absolute;
        }
    </style>

    <script>

        function getClasses() {

            /*

             {
                Class1: {
                    extends; '',
                    impelemts: ['IInput', 'IInput']
                    type: 'classs',
                    fields: {
                        'aaa': 1,
                        'gggg': 2,
                        'rrrr': 4
                    },
                    methods: {
                        'aaa': function(){}
                    },
                    events: {

                    }
                }
            */

            return {

                Class1: {
                    fields: {
                        'aaa': 1,
                        'gggg': 2,
                        'rrrr': 4
                    }
                },

                Class2: {
                    extend: 'Class1',
                    type: '类',
                    fields: {
                        'aaa': 1,
                        'gggg': 2,
                        'rrrr': 4
                    },
                    methods: {
                        'aaa': function(){}
                    }
                }



            };

        }

        // 绘图

        // 分析类的列表并返回类树。
        function getClasssDom(classes) {

            var r = [];

            // 统计每个类的直接子类

            for (var className in classes) {

                var clazz = classes[className];

                clazz.name = className;

                // 如果存在继承，则放到对应父类的 children 属性。
                if (clazz.extend && classes[clazz.extend]) {

                    var parentClass = classes[clazz.extend];

                    // 第一次添加时，初始化 children 属性。
                    if (!parentClass.children) {
                        parentClass.children = [];
                    }

                    parentClass.children.push(clazz);

                } else {

                    // 否则，它被添加到全局数组里。
                    r.push(clazz);

                }

            }

            // 统计每个类的全部子类个数

            getCount(r);

            function getCount(children) {

                var count = 0;

                for (var i = 0; i < children.length; i++) {

                    if (children[i].children) {
                        children[i].count = getCount(children[i].children);
                        count += children[i].count;
                    } else {
                        children[i].count = 0;
                        count++;
                    }

                }

                return count;
            }

            return r;

            /*
 
            [
                name: 'Class1',
                type: '类',
                count: 5,
                children: [{
                    name: 'Class1',
                    type: '类',
                }]
            */
        }

        function paintClassDom(classDom) {

            // 按照 count 排序

            classDom.sort(function (a, b) {
                return a.count - b.count;
            });

            // 绘制含子类的类。

            var i = 0;

            // 每个类的宽度。
            var objectWidth = 150;
            var objectHeight = 37;
            var objectMarginRight = 30;
            var objectMarginBottom = 60;

            var y = 0;

            var html = '';

            for (; i < classDom.length; i++) {

                // 如果不存在父类，也不存在子类，使用下一个 for 循环绘制。
                if (classDom[i].count === 0) {
                    break;
                }

                drawSignleLine({ children: [classDom[i]] });

            }

            // 画继承链中的一行。
            function drawSignleLine(parentClassDom) {

                var x = 0;

                for (var i = 0; i < parentClassDom.children.length; i++) {

                    var totalWidth = parentClassDom.children[i].count * objectWidth + (parentClassDom.children[i].count > 0 ? (parentClassDom.children[i].count - 1) * objectMarginRight : 0);

                    html += drawObject(totalWidth / 2 - objectWidth / 2, objectWidth, y);

                    x += totalWidth;

                }

                y += objectHeight + objectMarginBottom;

            }

            function drawSignleObject(clazz) {

                if (count === 0) {

                }

                var x = (count * objectWidth + (count - 1) * objectMarginRight) / 2 - objectWidth / 2;

                html += drawObject(x - objectWidth / 2, x + objectWidth, y);

                y += objectHeight + objectMarginBottom;

            }

            // 绘制不含子类的类。

            for (; i < classDom.length; i++) {


            }


        }

        // 绘图底层


        function drawObject(fromX, toX, y) {
            
        }

        function drawHorizonalLine(fromX, toX, y) {
            if (fromX > toX) {
                var t = toX;
                toX = fromX;
                fromX = t;
            }
            return '<div class="line-horizonal" style="top:' + y + 'px;left:' + fromX + 'px;width:' + (toX - fromX) + 'px"></div>';
        }

        function drawVerticalLine(x, fromY, toY) {
            if (fromY > toY) {
                var t = toY;
                toY = fromY;
                fromY = t;
            }
            return '<div class="line-vertical" style="left:' + x + 'px;top:' + fromY + 'px;height:' + (toY - fromY) + 'px"></div>';
        }

        function drawVerticalArrow(html, x, fromY, toY) {

        }

        function testDraw(func, args0, args1, args2) {
            var func = arguments[0];
            document.getElementById('body').innerHTML = func.call(this, args0, args1, args2);
        }

    </script>
</head>
<body>
    <article class="demo">

        <div id="body">
        </div>

        <aside class="object">
            <header>
                <div class="collapse">
                </div>
                <h4>Class</h4>
                <div>类</div>
                <div><span class="rightarrow"></span><a href="#">Class</a></div>
            </header>
            <dl>
                <dt>字段</dt>
                <dd>
                    <span class="icon-member icon-static"></span><span class="icon-member icon-field"></span><a href="#">aaa</a>
                </dd>
                <dt>方法</dt>
                <dd>
                    <span class="icon-member icon-none"></span><span class="icon-member icon-method"></span><a href="#">aaa</a>
                </dd>
                <dd>
                    <span class="icon-member icon-static"></span><span class="icon-member icon-method"></span><a href="#">aaa</a>
                </dd>
                <dt>事件</dt>
                <dd>
                    <span class="icon-member icon-none"></span><span class="icon-member icon-event"></span><a href="#">aaa</a>
                </dd>
            </dl>
        </aside>

        <aside class="object collapsed" style="left: 44px">
            <header>
                <div class="collapse">
                </div>
                <h4>Class</h4>
                <div>类</div>
            </header>
            <dl>
                <dd>
                    <a href="#">aaa</a>
                </dd>
            </dl>
        </aside>

        <aside class="source">
            <span class="arrow"><span class="arrow-fore">◆</span></span>
            <pre class="sh">AAAA</pre>
        </aside>

        <div class="arrow-top">
            △
        </div>
        <div class="arrow-circle">
            ◦
        </div>
        <div class="line-horizonal">
           
        </div>
        <div class="line-vertical">
            
        </div>
    </article>

</body>
</html>
